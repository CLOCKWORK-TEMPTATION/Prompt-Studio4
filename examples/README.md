# أمثلة التعاون الحي

## collaboration-demo.html

مثال تجريبي تفاعلي لنظام التعاون الحي باستخدام WebSocket و CRDT.

### كيفية الاستخدام

#### 1. تشغيل الخادم

أولاً، تأكد من تشغيل خادم التطبيق:

```bash
npm run dev
```

سيعمل الخادم على `http://localhost:5000` ويتضمن خادم WebSocket تلقائياً.

#### 2. فتح المثال التجريبي

افتح الملف [collaboration-demo.html](collaboration-demo.html) في متصفحك:

**الطريقة الأولى** - عبر الخادم (مفضل):
```
http://localhost:5000/examples/collaboration-demo.html
```

**الطريقة الثانية** - فتح مباشر:
```
افتح الملف مباشرة من نظام الملفات
```

#### 3. تجربة التعاون

1. افتح الصفحة في **عدة نوافذ أو متصفحات مختلفة**
2. في كل نافذة:
   - أدخل اسم مستخدم مختلف
   - استخدم **نفس معرف الغرفة** (مثلاً: `test-room-123`)
   - اضغط زر "اتصل"
3. ابدأ الكتابة في أي نافذة
4. شاهد التحديثات الفورية تظهر في جميع النوافذ الأخرى

### الميزات

- ✅ **مزامنة فورية**: التعديلات تظهر في الوقت الفعلي
- ✅ **عدة مستخدمين**: دعم غير محدود من المستخدمين
- ✅ **مؤشر الحالة**: يعرض حالة الاتصال والمستخدمين المتصلين
- ✅ **صور رمزية**: كل مستخدم له لون مميز
- ✅ **CRDT**: حل تلقائي للتعارضات
- ✅ **إعادة اتصال تلقائي**: في حالة انقطاع الاتصال

### سيناريوهات الاختبار

#### اختبار أساسي
1. افتح نافذتين
2. اكتب في النافذة الأولى
3. تحقق من ظهور النص في النافذة الثانية

#### اختبار التعارضات
1. افتح 3 نوافذ أو أكثر
2. اكتب في جميع النوافذ في نفس الوقت
3. تحقق من أن جميع التعديلات تظهر بشكل صحيح

#### اختبار الانقطاع
1. افتح نافذتين
2. افصل إحدى النوافذ
3. اكتب في النافذة المتصلة
4. أعد الاتصال في النافذة المنفصلة
5. تحقق من المزامنة

#### اختبار الانضمام المتأخر
1. افتح نافذة واكتب بعض النص
2. افتح نافذة ثانية جديدة
3. تحقق من أن النافذة الجديدة تستقبل المحتوى الموجود

### البنية التقنية

```javascript
// المكونات الرئيسية المستخدمة
- Socket.IO Client (اتصال WebSocket)
- Y.js (محرك CRDT)
- Vanilla JavaScript (لتبسيط المثال)
```

### التخصيص

يمكنك تخصيص المثال لتجربة:

1. **تغيير الألوان**: عدّل مصفوفة `colors` في دالة `generateColor()`
2. **تغيير معالجة النص**: عدّل event listener للمحرر
3. **إضافة ميزات**: مثل تتبع المؤشر أو التحديد

### الكود الرئيسي

```javascript
// الاتصال بالخادم
socket = io(window.location.origin);

// إنشاء مستند Y.js
doc = new Y.Doc();
text = doc.getText('content');

// المزامنة مع الخادم
socket.on('sync-update', (update) => {
  Y.applyUpdate(doc, new Uint8Array(update));
});

// إرسال التحديثات
const update = Y.encodeStateAsUpdate(doc);
socket.emit('sync-update', { roomId, update });
```

### استكشاف الأخطاء

#### المشكلة: لا يتصل بالخادم
- تأكد من أن الخادم يعمل على المنفذ 5000
- تحقق من Console في المتصفح للأخطاء
- جرب فتح الصفحة من خلال الخادم بدلاً من الملف المباشر

#### المشكلة: لا يتم المزامنة
- تأكد من استخدام نفس معرف الغرفة
- تحقق من حالة الاتصال (يجب أن تكون "متصل")
- افحص سجلات الخادم للأخطاء

#### المشكلة: أداء بطيء
- قلل عدد المستخدمين المتصلين
- قلل حجم المحتوى
- تحقق من اتصال الشبكة

### المزيد من الأمثلة

لمزيد من الأمثلة المتقدمة، راجع:
- [docs/COLLABORATION.md](../docs/COLLABORATION.md) - دليل الاستخدام الكامل
- [client/src/hooks/useCollaboration.ts](../client/src/hooks/useCollaboration.ts) - React Hook
- [client/src/components/collaboration/](../client/src/components/collaboration/) - مكونات React

### الدعم

للأسئلة أو المشاكل:
1. راجع [docs/COLLABORATION.md](../docs/COLLABORATION.md)
2. افحص سجلات Console في المتصفح
3. افحص سجلات الخادم
4. راجع الاختبارات في [server/__tests__/](../server/__tests__/)

### الترخيص

MIT License - راجع ملف LICENSE للتفاصيل.
