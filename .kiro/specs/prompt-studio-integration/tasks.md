
الدور الأساسي: نظام محاكاة إدارة مشاريع متعدد الوكلاء (Multi-Agent System Simulator)
أنت الآن تعمل كنظام ذكاء اصطناعي متقدم لمحاكاة فريق عمل مكون من 16 وكلاء أذكياء (AI Agents). مهمتك هي إدارة وتنفيذ مشروع معقد بناءً على مدخلات المستخدم، من خلال تقمص الأدوار التالية بدقة متناهية.

هيكلية الفريق والأدوار:

الوكيل المايسترو (The Maestro - Agent 0)
الدور: مدير المشروع، المنسق العام، والمراقب.
المسؤوليات:
- استلام وصف المشروع وتفاصيل الـ "Epics" من المستخدم (متوفرة أدناه: من المرحلة 1  الى المرحلة 15 ).
- توزيع المهام على الوكلاء الخمسة عشر  الآخرين حسب الخطة المحددة.
- تزويد جميع الوكلاء بسياق كامل عن المشروع لضمان التكامل.
- مراقبة المخرجات لمنع التعارض أو التضارب.
- تجميع النتائج النهائية وتقديم تقرير موحد داخل وصف الـ PR (وليس داخل الرد فقط).

الوكلاء المنفذون (Agents 1-15)
الدور: متخصصون تقنيون يقومون بتنفيذ المهام الموكلة إليهم في "شجرة عمل" (Work Tree) منفصلة ومعزولة، مع الحفاظ على الوعي بما يفعله الآخرون.

توزيع المهام (إلزامي):
الوكيل الأول: مسؤول عن تنفيذ Epic1
1.1 استنساخ وتحليل مستودع PromptStudio
1.2 تحليل التبعيات والتعارضات
1.3 كتابة اختبار خاصية لتحليل البنية
الوكيل الثاني: مسؤول عن تنفيذ Epic2
2.1 توسيع مخطط قاعدة البيانات
2.2 إنشاء ملفات الترحيل
2.3 كتابة اختبار خاصية لتوحيد قاعدة البيانات
2.4 تحديث أنواع TypeScript
الوكيل الثالث: مسؤول عن تنفيذ Epic3
3.1 دمج ملف package.json
3.2 دمج إعدادات TypeScript وVite
3.3 كتابة اختبار خاصية لدمج التبعيات
3.4 اختبار البناء والتطوير
الوكيل الرابع: مسؤول عن تنفيذ Epic4
4.1 نسخ خدمات PromptStudio الأساسية
4.2 تكييف الخدمات مع البنية الحالية
4.3 كتابة اختبار خاصية لتوحيد APIs
4.4 إضافة نقاط النهاية الجديدة
الوكيل الخامس: مسؤول عن تنفيذ Epic5
5.1 إعداد خادم WebSocket
5.2 تنفيذ نظام CRDT
5.3 كتابة اختبار خاصية للتعاون الحي
5.4 اختبار التعاون الحي
الوكيل السادس: مسؤول عن تنفيذ Epic6
6.1 نسخ مكونات PromptStudio الأساسية
6.2 تكييف المكونات مع نظام التصميم الحالي
6.3 كتابة اختبار خاصية لتوحيد واجهة المستخدم
6.4 إضافة صفحات جديدة
الوكيل السابع: مسؤول عن تنفيذ Epic7
7.1 إضافة روابط الصفحات الجديدة
7.2 تحديث الصفحة الرئيسية
7.3 كتابة اختبار خاصية للتنقل
الوكيل الثامن: مسؤول عن تنفيذ Epic8
8.1 إعداد خدمة التخزين المؤقت الدلالي
8.2 تكامل مع OpenAI Embeddings
8.3 كتابة اختبار خاصية للتخزين المؤقت الدلالي
8.4 إنشاء لوحة تحكم التحليلات
الوكيل التاسع: مسؤول عن تنفيذ Epic9
9.1 إعداد مولدات SDK
9.2 تنفيذ ميزات SDK المتقدمة
9.3 كتابة اختبار خاصية لتوليد SDK
9.4 اختبار SDK المولد
الوكيل العاشر: مسؤول عن تنفيذ Epic10
10.1 تنفيذ مولدات النشر
10.2 إعداد أدوات النشر
10.3 كتابة اختبار خاصية للنشر السحابي
الوكيل الحادي عشر: مسؤول عن تنفيذ Epic11
11.1 اختبار الوظائف الحالية
11.2 كتابة اختبار خاصية للحفاظ على الوظائف
11.3 اختبار الأداء
11.4 كتابة اختبار خاصية للأداء
الوكيل الثاني عشر: مسؤول عن تنفيذ Epic12
12.1 تحديث ملفات Docker
12.2 إعداد متغيرات البيئة
12.3 كتابة اختبار خاصية لنظام البناء
الوكيل الثالث عشر: مسؤول عن تنفيذ Epic13
13.1 تحديث التوثيق التقني
13.2 إنشاء دليل المستخدم
13.3 توثيق التغييرات
الوكيل الرابع عشر: مسؤول عن تنفيذ Epic14
14.1 تشغيل جميع الاختبارات
14.2 اختبار شامل للتطبيق المدمج
الوكيل الخامس عشر: مسؤول عن تنفيذ Epic15
15.1 تنظيف الملفات المؤقتة
15.2 إعداد الإنتاج النهائي

بروتوكول العمل (Operational Protocol):
- الشفافية الكاملة: قبل البدء، ينشر المايسترو ملخص الحالة العامة (Global State Summary) داخل وصف الـ PR: ماذا سيفعل كل وكيل + نقاط الدمج.
- أشجار العمل المنفصلة: اجعل التغييرات واضحة ومنفصلة قدر الإمكان (modules/paths)، ثم دمجها بعناية.
- التنفيذ الشامل: نفّذ كود + migrations + اختبارات + توثيق.
- منع التعارض: ممنوع تكرار نفس المنطق في أكثر من مكان (خصوصًا prompt rendering / variable substitution / LLM calling).

تعليمات المخرجات (Output Format):
- هذا الأمر التوجيهي موجّه إلى Claude Code لتنفيذ التغييرات فورًا على الريبو.
- التنفيذ يجب أن ينتج PR جاهز، لا خطة فقط.

------------------------------------------------------------
# CLAUDE CODE — تنفيذ فوري: EPIC 4 + EPIC 5 لمشروع PromptStudio

# خطة تنفيذ دمج PromptStudio

## Epic1. إعداد البنية الأساسية والتحليل

- [ ] 1.1 استنساخ وتحليل مستودع PromptStudio
  - استنساخ المستودع إلى مجلد مؤقت
  - تحليل بنية المشروع والمكونات
  - توثيق جميع الوظائف والميزات الموجودة
  - _المتطلبات: 1.1, 1.2_

- [ ] 1.2 تحليل التبعيات والتعارضات
  - مقارنة ملفات package.json من كلا التطبيقين
  - تحديد التبعيات المشتركة والمتعارضة
  - إنشاء قائمة بالتبعيات المطلوب دمجها
  - _المتطلبات: 1.3, 5.1_

- [ ] 1.3 كتابة اختبار خاصية لتحليل البنية
  - **الخاصية 2: دمج التبعيات بدون تعارض**
  - **تتحقق من: المتطلبات 5.1, 5.2**

## Epic2. دمج قاعدة البيانات والمخطط

- [ ] 2.1 توسيع مخطط قاعدة البيانات
  - إضافة جداول PromptStudio الجديدة إلى shared/schema.ts
  - إنشاء العلاقات بين الجداول الجديدة والموجودة
  - التأكد من عدم تعارض أسماء الجداول والحقول
  - _المتطلبات: 2.1, 2.2, 2.3_

- [ ] 2.2 إنشاء ملفات الترحيل
  - إنشاء ملفات ترحيل Drizzle للجداول الجديدة
  - اختبار الترحيل على قاعدة بيانات تطوير
  - التأكد من الحفاظ على البيانات الموجودة
  - _المتطلبات: 2.4, 2.5_

- [ ] 2.3 كتابة اختبار خاصية لتوحيد قاعدة البيانات
  - **الخاصية 3: توحيد قاعدة البيانات**
  - **تتحقق من: المتطلبات 2.1, 2.2, 2.3**

- [ ] 2.4 تحديث أنواع TypeScript
  - تحديث ملفات الأنواع لتشمل الجداول الجديدة
  - إنشاء واجهات للبيانات الجديدة
  - التأكد من التوافق مع الأنواع الموجودة
  - _المتطلبات: 2.5_

## Epic3. دمج التبعيات وإعدادات المشروع

- [ ] 3.1 دمج ملف package.json
  - دمج التبعيات من كلا المشروعين
  - حل التعارضات باختيار الإصدارات الأحدث المتوافقة
  - تحديث النصوص (scripts) لتشمل الوظائف الجديدة
  - _المتطلبات: 5.1, 5.2, 5.4_

- [ ] 3.2 دمج إعدادات TypeScript وVite
  - دمج إعدادات tsconfig.json
  - دمج إعدادات vite.config.ts
  - التأكد من التوافق مع البنية الجديدة
  - _المتطلبات: 5.3_

- [ ] 3.3 كتابة اختبار خاصية لدمج التبعيات
  - **الخاصية 2: دمج التبعيات بدون تعارض**
  - **تتحقق من: المتطلبات 5.1, 5.2**

- [ ] 3.4 اختبار البناء والتطوير
  - تشغيل أوامر البناء والتطوير
  - التأكد من عدم وجود أخطاء في التجميع
  - اختبار جميع النصوص الجديدة
  - _المتطلبات: 5.5_

## Epic4 دمج خدمات الخادم (Backend Services)

- [ ] 4.1 نسخ خدمات PromptStudio الأساسية
  - نسخ خدمات التعاون الحي (CollaborationService, CRDTManager)
  - نسخ خدمات التخزين المؤقت الدلالي (SemanticCacheService)
  - نسخ خدمات توليد SDK (SDKGeneratorService)
  - نسخ خدمات النشر السحابي (CloudDeploymentService)
  - _المتطلبات: 8.1, 8.2, 8.4_

- [ ] 4.2 تكييف الخدمات مع البنية الحالية
  - تحديث مسارات الاستيراد
  - تكييف الخدمات لاستخدام نفس نمط المصادقة
  - توحيد معالجة الأخطاء
  - _المتطلبات: 4.3, 4.4_

- [ ] 4.3 كتابة اختبار خاصية لتوحيد APIs
  - **الخاصية 5: توحيد APIs**
  - **تتحقق من: المتطلبات 4.1, 4.3, 4.4**

- [ ] 4.4 إضافة نقاط النهاية الجديدة
  - إضافة مسارات API للتعاون الحي (/api/collaboration/*)
  - إضافة مسارات API للتخزين المؤقت الدلالي (/api/cache/*)
  - إضافة مسارات API لتوليد SDK (/api/sdk/*)
  - إضافة مسارات API للنشر السحابي (/api/deploy/*)
  - _المتطلبات: 4.2_

## Epic5 دمج WebSocket والتعاون الحي

- [ ] 5.1 إعداد خادم WebSocket
  - إضافة Socket.IO إلى الخادم الحالي
  - إنشاء معالجات الأحداث للتعاون الحي
  - إعداد إدارة الجلسات والحضور
  - _المتطلبات: 8.2_

- [ ] 5.2 تنفيذ نظام CRDT
  - إضافة مكتبة Yjs للتحرير التعاوني
  - إنشاء مدير CRDT للمزامنة
  - تنفيذ نظام حل التعارضات
  - _المتطلبات: 8.2_

- [ ] 5.3 كتابة اختبار خاصية للتعاون الحي
  - **الخاصية 6: التعاون الحي**
  - **تتحقق من: المتطلبات 8.2**

- [ ] 5.4 اختبار التعاون الحي
  - اختبار المزامنة بين عدة مستخدمين
  - اختبار استقرار الاتصال
  - اختبار معالجة انقطاع الشبكة
  - _المتطلبات: 8.5_

## Epic6 دمج مكونات الواجهة الأمامية

- [ ] 6.1 نسخ مكونات PromptStudio الأساسية
  - نسخ مكونات محرر المطالبات المتقدم
  - نسخ مكونات التعاون الحي
  - نسخ مكونات توليد SDK
  - نسخ مكونات النشر السحابي
  - _المتطلبات: 8.1, 8.3_

- [ ] 6.2 تكييف المكونات مع نظام التصميم الحالي
  - تحديث المكونات لاستخدام نفس متغيرات CSS
  - توحيد الألوان والخطوط
  - التأكد من التوافق مع shadcn/ui
  - _المتطلبات: 3.3_

- [ ] 6.3 كتابة اختبار خاصية لتوحيد واجهة المستخدم
  - **الخاصية 4: توحيد واجهة المستخدم**
  - **تتحقق من: المتطلبات 3.1, 3.3**

- [ ] 6.4 إضافة صفحات جديدة
  - إنشاء صفحة محرر المطالبات المتقدم
  - إنشاء صفحة إدارة الجلسات التعاونية
  - إنشاء صفحة توليد SDK
  - إنشاء صفحة النشر السحابي
  - _المتطلبات: 3.2_

## Epic7 تحديث نظام التنقل والتوجيه

- [ ] 7.1 إضافة روابط الصفحات الجديدة
  - تحديث قائمة التنقل الرئيسية
  - إضافة أيقونات للأقسام الجديدة
  - تحديث نظام التوجيه
  - _المتطلبات: 3.4_

- [ ] 7.2 تحديث الصفحة الرئيسية
  - إضافة روابط سريعة للوظائف الجديدة
  - تحديث الوصف والميزات
  - إضافة أمثلة على الاستخدام
  - _المتطلبات: 6.1_

- [ ] 7.3 كتابة اختبار خاصية للتنقل
  - **الخاصية 4: توحيد واجهة المستخدم**
  - **تتحقق من: المتطلبات 3.4**

## Epic8 تنفيذ التخزين المؤقت الدلالي

- [ ] 8.1 إعداد خدمة التخزين المؤقت الدلالي
  - تنفيذ خوارزمية حساب التشابه الدلالي
  - إعداد تخزين المتجهات (vectors) في PostgreSQL
  - تنفيذ منطق انتهاء الصلاحية والتنظيف
  - _المتطلبات: 8.2_

- [ ] 8.2 تكامل مع OpenAI Embeddings
  - إعداد اتصال مع OpenAI API للحصول على embeddings
  - تنفيذ تخزين مؤقت للـ embeddings
  - معالجة أخطاء الخدمة الخارجية
  - _المتطلبات: 8.2_

- [ ] 8.3 كتابة اختبار خاصية للتخزين المؤقت الدلالي
  - **الخاصية 7: التخزين المؤقت الدلالي**
  - **تتحقق من: المتطلبات 8.2**

- [ ] 8.4 إنشاء لوحة تحكم التحليلات
  - إنشاء واجهة لعرض إحصائيات التخزين المؤقت
  - عرض معدل النجاح والتوفير في التكلفة
  - إضافة أدوات إدارة التخزين المؤقت
  - _المتطلبات: 8.2_

## Epic9 تنفيذ توليد SDK

- [ ] 9.1 إعداد مولدات SDK
  - تنفيذ مولد Python SDK
  - تنفيذ مولد TypeScript SDK
  - إنشاء قوالب الكود القابلة للتخصيص
  - _المتطلبات: 8.2_

- [ ] 9.2 تنفيذ ميزات SDK المتقدمة
  - إضافة منطق إعادة المحاولة
  - تنفيذ معالجة الأخطاء المخصصة
  - إضافة دعم التوقيعات النوعية
  - _المتطلبات: 8.2_

- [ ] 9.3 كتابة اختبار خاصية لتوليد SDK
  - **الخاصية 8: توليد SDK**
  - **تتحقق من: المتطلبات 8.2**

- [ ] 9.4 اختبار SDK المولد
  - اختبار تشغيل الكود المولد
  - التحقق من خلو الكود من الأخطاء النحوية
  - اختبار الوظائف المختلفة
  - _المتطلبات: 8.5_

## Epic10 تنفيذ النشر السحابي

- [ ] 10.1 تنفيذ مولدات النشر
  - تنفيذ مولد Vercel Edge Functions
  - تنفيذ مولد Cloudflare Workers
  - تنفيذ مولد AWS Lambda
  - تنفيذ مولد Google Cloud Functions
  - _المتطلبات: 8.2_

- [ ] 10.2 إعداد أدوات النشر
  - إنشاء ملفات التكوين لكل منصة
  - تنفيذ معالجة أخطاء النشر
  - إضافة مراقبة حالة النشر
  - _المتطلبات: 8.2_

- [ ] 10.3 كتابة اختبار خاصية للنشر السحابي
  - **الخاصية 9: النشر السحابي**
  - **تتحقق من: المتطلبات 8.2**

## Epic11 اختبار التكامل والحفاظ على الوظائف الحالية

- [ ] 11.1 اختبار الوظائف الحالية
  - اختبار نظام الوكلاء الثلاثة
  - اختبار سير العمل السبع مراحل
  - اختبار جميع APIs الموجودة
  - التأكد من عدم كسر أي وظيفة
  - _المتطلبات: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 11.2 كتابة اختبار خاصية للحفاظ على الوظائف
  - **الخاصية 1: الحفاظ على الوظائف الحالية**
  - **تتحقق من: المتطلبات 7.1, 7.2, 7.3, 7.4, 7.5**

- [ ] 11.3 اختبار الأداء
  - قياس أوقات الاستجابة قبل وبعد الدمج
  - التأكد من عدم تدهور الأداء
  - اختبار الحمولة على الوظائف الجديدة
  - _المتطلبات: 6.3_

- [ ] 11.4 كتابة اختبار خاصية للأداء
  - **الخاصية 10: الحفاظ على الأداء**
  - **تتحقق من: المتطلبات 6.3**

## Epic12  إعداد Docker والبنية التحتية

- [ ] 12.1 تحديث ملفات Docker
  - دمج إعدادات Docker من كلا المشروعين
  - تحديث docker-compose.yml
  - إضافة خدمات Redis للتخزين المؤقت
  - _المتطلبات: 9.1, 9.2_

- [ ] 12.2 إعداد متغيرات البيئة
  - دمج متغيرات البيئة المطلوبة
  - إنشاء ملف .env.example محدث
  - توثيق جميع المتغيرات الجديدة
  - _المتطلبات: 9.3_

- [ ] 12.3 كتابة اختبار خاصية لنظام البناء
  - **الخاصية 11: سلامة البيانات**
  - **تتحقق من: المتطلبات 9.1, 9.2, 9.5**

## Epic13 التوثيق والدليل

- [ ] 13.1 تحديث التوثيق التقني
  - توثيق البنية الجديدة للمشروع المدمج
  - توثيق جميع APIs الجديدة
  - توثيق مخطط قاعدة البيانات المحدث
  - _المتطلبات: 10.1, 10.3, 10.4_

- [ ] 13.2 إنشاء دليل المستخدم
  - كتابة دليل شامل لاستخدام الوظائف الجديدة
  - إضافة أمثلة عملية وصور توضيحية
  - ترجمة الدليل للعربية والإنجليزية
  - _المتطلبات: 10.5_

- [ ] 13.3 توثيق التغييرات
  - إنشاء ملف CHANGELOG مفصل
  - توثيق جميع التغييرات والإضافات
  - إضافة ملاحظات الترحيل
  - _المتطلبات: 10.2_

## Epic14 نقطة تفتيش نهائية - التأكد من نجاح جميع الاختبارات

- [ ] 14.1 تشغيل جميع الاختبارات
  - تشغيل اختبارات الوحدة
  - تشغيل اختبارات التكامل
  - تشغيل اختبارات الخصائص
  - التأكد من نجاح جميع الاختبارات
  - التأكد من نجاح جميع الاختبارات، اسأل المستخدم إذا ظهرت أسئلة.

- [ ] 14.2 اختبار شامل للتطبيق المدمج
  - اختبار جميع الوظائف الحالية والجديدة
  - اختبار التكامل بين المكونات المختلفة
  - اختبار الأداء والاستقرار
  - التأكد من جودة تجربة المستخدم
  - _المتطلبات: 6.1, 6.2, 6.3, 6.4, 6.5_

## Epic15 تنظيف وإنهاء المشروع

- [ ] 15.1 تنظيف الملفات المؤقتة
  - حذف مجلد temp-promptstudio
  - تنظيف ملفات البناء المؤقتة
  - تحديث ملف .gitignore
  - _المتطلبات: 9.4_

- [ ] 15.2 إعداد الإنتاج النهائي
  - اختبار البناء للإنتاج
  - التأكد من عمل جميع الأوامر
  - إنشاء دليل النشر
  - _المتطلبات: 9.5_