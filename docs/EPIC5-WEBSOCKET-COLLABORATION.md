# Epic 5: WebSocket and Live Collaboration

## โ ููุฎุต ุงูุชูููุฐ

ุชู ุชูููุฐ ูุธุงู ุชุนุงูู ุญู ูุงูู ููุชูุฏู ูุณุชุฎุฏู WebSocket ู CRDT (Conflict-free Replicated Data Type) ูุชูููู ุนุฏุฉ ูุณุชุฎุฏููู ูู ุงูุชุนุฏูู ุนูู ููุณ ุงููุณุชูุฏุงุช ูู ุงูููุช ุงููุนูู.

## ๐ฏ ุงูููุงู ุงูููุฌุฒุฉ

### 5.1 ุฅุนุฏุงุฏ ุฎุงุฏู WebSocket โ

**ุงููููุงุช:**
- [server/websocket.ts](../server/websocket.ts) - ุฎุงุฏู WebSocket ุงูุฑุฆูุณู
- [server/index.ts](../server/index.ts) - ุฏูุฌ WebSocket ูุน ุงูุฎุงุฏู

**ุงูููุฒุงุช:**
- ุฅุฏุงุฑุฉ ุงูุงุชุตุงูุงุช ูู ุงูููุช ุงููุนูู ุจุงุณุชุฎุฏุงู Socket.IO
- ูุธุงู ุงูุบุฑู (Rooms) ููุชุนุงูู ุงูุฌูุงุนู
- ูุฒุงููุฉ ุงูุญุงูุฉ ุงูุฃูููุฉ ูููุณุชุฎุฏููู ุงูุฌุฏุฏ
- ุชุชุจุน ุงููุณุชุฎุฏููู ุงููุชุตููู ูู ูู ุบุฑูุฉ
- ุชูุธูู ุชููุงุฆู ููุบุฑู ุงููุงุฑุบุฉ ูู 5 ุฏูุงุฆู
- ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ: join-room, leave-room, sync-update, cursor-update, selection-update

### 5.2 ุชูููุฐ ูุธุงู CRDT โ

**ุงููููุงุช:**
- [client/src/lib/collaboration.ts](../client/src/lib/collaboration.ts) - ูุฏูุฑ ุงูุชุนุงูู
- [client/src/hooks/useCollaboration.ts](../client/src/hooks/useCollaboration.ts) - React Hook
- [client/src/components/collaboration/CollaborationProvider.tsx](../client/src/components/collaboration/CollaborationProvider.tsx)
- [client/src/components/collaboration/CollaborationIndicator.tsx](../client/src/components/collaboration/CollaborationIndicator.tsx)
- [client/src/components/collaboration/CollaborationCursor.tsx](../client/src/components/collaboration/CollaborationCursor.tsx)

**ุงูููุฒุงุช:**
- ุงุณุชุฎุฏุงู Yjs ููุญุฑู CRDT
- `CollaborationManager` ูุฅุฏุงุฑุฉ ุงููุณุชูุฏุงุช ูุงูุงุชุตุงูุงุช
- ุฏุนู Y.Text ูููุตูุต
- ุฏุนู Y.Map ููุจูุงูุงุช ุงููููููุฉ
- ูุฒุงููุฉ ุชููุงุฆูุฉ ููุชุญุฏูุซุงุช
- ุชุชุจุน ุงููุคุดุฑุงุช ูุงูุชุญุฏูุฏุงุช
- ููููุงุช React ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู
- ุชูููุฏ ุฃููุงู ุนุดูุงุฆูุฉ ูููุณุชุฎุฏููู
- ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู

### 5.3 ูุชุงุจุฉ ุงุฎุชุจุงุฑุงุช ุงูุฎุตุงุฆุต (Property Tests) โ

**ุงููููุงุช:**
- [server/__tests__/collaboration.test.ts](../server/__tests__/collaboration.test.ts) - ุงุฎุชุจุงุฑุงุช ุฎุตุงุฆุต CRDT
- [server/__tests__/websocket.test.ts](../server/__tests__/websocket.test.ts) - ุงุฎุชุจุงุฑุงุช ุชูุงูู WebSocket
- [jest.config.js](../jest.config.js) - ุชูููู Jest
- [jest.setup.js](../jest.setup.js) - ุฅุนุฏุงุฏ Jest

**ุงูุงุฎุชุจุงุฑุงุช:**

#### ุงุฎุชุจุงุฑุงุช ุฎุตุงุฆุต CRDT (11 ุงุฎุชุจุงุฑ):
1. โ ุงูุชุจุงุฏููุฉ (Commutativity) - ุชุทุจูู ุงูุนูููุงุช ุจุฃู ุชุฑุชูุจ
2. โ ุงูุชุฑุงุจุทูุฉ (Associativity) - ุชุฌููุน ุงูุนูููุงุช
3. โ ุงูุฅุฏูุจูุชูุณ (Idempotence) - ุชุทุจูู ูุชุนุฏุฏ ูููุณ ุงูุชุญุฏูุซ
4. โ ุงูุชูุงุฑุจ (Convergence) - ุชุฒุงูู ุฌููุน ุงููุณุฎ
5. โ ุงูุญูุงุธ ุนูู ุงูุณุจุจูุฉ (Causality Preservation)
6. โ ูุนุงูุฌุฉ ุงูุญุฐู (Deletion Handling)
7. โ ุฎุตุงุฆุต Map CRDT
8. โ ุชุญูู ุชูุณูู ุงูุดุจูุฉ (Network Partition Tolerance)

#### ุงุฎุชุจุงุฑุงุช ุชูุงูู WebSocket (6 ุงุฎุชุจุงุฑุงุช):
1. โ ุงูุงุชุตุงู ุจุงูุฎุงุฏู
2. โ ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ
3. โ ูุฒุงููุฉ ุงูุชุญุฏูุซุงุช ุจูู ุนููููู
4. โ ุฅุดุนุงุฑุงุช ุงูุถูุงู ุงููุณุชุฎุฏููู
5. โ ุฅุดุนุงุฑุงุช ูุบุงุฏุฑุฉ ุงููุณุชุฎุฏููู
6. โ ุงูุชุนุฏููุงุช ุงููุชุฒุงููุฉ ูู ุนุฏุฉ ุนููุงุก

**ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช:**
```
PASS server/__tests__/collaboration.test.ts
  โ 11 tests passed

PASS server/__tests__/websocket.test.ts
  โ 6 tests passed

Total: 17 tests passed
```

### 5.4 ุงุฎุชุจุงุฑ ุงูุชุนุงูู ุงูุญู โ

**ุงููููุงุช:**
- [examples/collaboration-demo.html](../examples/collaboration-demo.html) - ูุซุงู ุชุฌุฑูุจู ุชูุงุนูู
- [docs/COLLABORATION.md](../docs/COLLABORATION.md) - ูุซุงุฆู ุดุงููุฉ

**ุงููุซุงู ุงูุชุฌุฑูุจู:**
- ูุงุฌูุฉ ููุจ ุชูุงุนููุฉ ูุงููุฉ
- ุฏุนู ุนุฏุฉ ูุณุชุฎุฏููู ูู ููุณ ุงูุบุฑูุฉ
- ุนุฑุถ ุญุงูุฉ ุงูุงุชุตุงู ูุงููุณุชุฎุฏููู ุงููุชุตููู
- ูุฒุงููุฉ ููุฑูุฉ ููุชุนุฏููุงุช
- ุชุตููู ุนุตุฑู ูุฌุฐุงุจ
- ุชุนูููุงุช ุงุณุชุฎุฏุงู ูุงุถุญุฉ

## ๐ง ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

- **Socket.IO** (v4.7.2) - WebSocket ููุงุชุตุงู ูู ุงูููุช ุงููุนูู
- **Yjs** (v13.6.10) - ูุญุฑู CRDT ูููุฒุงููุฉ
- **React** (v19.2.3) - ููููุงุช UI
- **TypeScript** (v5.6.3) - ุณูุงูุฉ ุงูุฃููุงุน
- **Jest** (v30.2.0) - ุฅุทุงุฑ ุงูุงุฎุชุจุงุฑ
- **ts-jest** (v29.4.6) - ุฏุนู TypeScript ูู Jest

## ๐ ูููู ุงููููุงุช

```
server/
โโโ websocket.ts                 # ุฎุงุฏู WebSocket ุงูุฑุฆูุณู
โโโ index.ts                     # ุฏูุฌ WebSocket
โโโ __tests__/
    โโโ collaboration.test.ts    # ุงุฎุชุจุงุฑุงุช ุฎุตุงุฆุต CRDT
    โโโ websocket.test.ts        # ุงุฎุชุจุงุฑุงุช ุชูุงูู WebSocket

client/src/
โโโ lib/
โ   โโโ collaboration.ts         # ูุฏูุฑ ุงูุชุนุงูู ุงูุฃุณุงุณู
โโโ hooks/
โ   โโโ useCollaboration.ts      # React Hook
โโโ components/
    โโโ collaboration/
        โโโ CollaborationProvider.tsx
        โโโ CollaborationIndicator.tsx
        โโโ CollaborationCursor.tsx

examples/
โโโ collaboration-demo.html      # ูุซุงู ุชุฌุฑูุจู ุชูุงุนูู

docs/
โโโ COLLABORATION.md             # ูุซุงุฆู ุดุงููุฉ
โโโ EPIC5-WEBSOCKET-COLLABORATION.md  # ูุฐุง ุงูููู

jest.config.js                   # ุชูููู Jest
jest.setup.js                    # ุฅุนุฏุงุฏ Jest
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชุดุบูู ุงูุฎุงุฏู

```bash
npm run dev
```

ุงูุฎุงุฏู ุณูุจุฏุฃ ุนูู ุงููููุฐ 5000 ููุชุถูู WebSocket ุชููุงุฆูุงู.

### 2. ุงุณุชุฎุฏุงู ูู React

```tsx
import { CollaborationProvider } from "@/components/collaboration";

function App() {
  return (
    <CollaborationProvider roomId="my-room" userName="John">
      <YourEditor />
    </CollaborationProvider>
  );
}
```

### 3. ุงุณุชุฎุฏุงู ุงููุซุงู ุงูุชุฌุฑูุจู

ุงูุชุญ `examples/collaboration-demo.html` ูู ุนุฏุฉ ููุงูุฐ ูุชุตูุญ:

1. ุงูุชุญ ุงูููู ูู ูุงูุฐุชูู ุฃู ุฃูุซุฑ
2. ุงุณุชุฎุฏู ููุณ ูุนุฑู ุงูุบุฑูุฉ ูู ุฌููุน ุงูููุงูุฐ
3. ุงุถุบุท "ุงุชุตู" ูู ูู ูุงูุฐุฉ
4. ุงุจุฏุฃ ุงููุชุงุจุฉ ูู ุฃู ูุงูุฐุฉ
5. ุดุงูุฏ ุงูุชุญุฏูุซุงุช ุงูููุฑูุฉ ูู ุฌููุน ุงูููุงูุฐ

### 4. ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช

```bash
# ุฌููุน ุงูุงุฎุชุจุงุฑุงุช
npm test

# ูุน ุงููุฑุงูุจุฉ
npm run test:watch

# ุชูุฑูุฑ ุงูุชุบุทูุฉ
npm run test:coverage
```

## ๐ ุฎุตุงุฆุต CRDT ุงููุทุจูุฉ

### 1. ุงูุชุจุงุฏููุฉ (Commutativity)
ุงูุนูููุงุช ูููู ุชุทุจูููุง ุจุฃู ุชุฑุชูุจ ูุงูุญุตูู ุนูู ููุณ ุงููุชูุฌุฉ:

```javascript
User1: insert(0, "Hello")
User2: insert(0, "World")
// ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ูุชุณูุฉ ูู ููุง ุงูุทุฑููู
```

### 2. ุงูุชุฑุงุจุทูุฉ (Associativity)
ุชุฌููุน ุงูุนูููุงุช ูุง ูุคุซุฑ ุนูู ุงููุชูุฌุฉ:

```javascript
(op1 + op2) + op3 = op1 + (op2 + op3)
```

### 3. ุงูุชูุงุฑุจ (Convergence)
ุฌููุน ุงููุณุฎ ุชุตู ูู ุงูููุงูุฉ ุฅูู ููุณ ุงูุญุงูุฉ:

```javascript
// ุจุนุฏ ุชุทุจูู ุฌููุน ุงูุชุญุฏูุซุงุช
doc1.state === doc2.state === doc3.state
```

### 4. ุงูุฅุฏูุจูุชูุณ (Idempotence)
ุชุทุจูู ููุณ ุงูุชุญุฏูุซ ุนุฏุฉ ูุฑุงุช = ุชุทุจููู ูุฑุฉ ูุงุญุฏุฉ:

```javascript
apply(update) === apply(apply(update))
```

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### CollaborationIndicator
```tsx
<CollaborationIndicator />
```
ูุนุฑุถ:
- ุญุงูุฉ ุงูุงุชุตุงู (ูุชุตู/ุบูุฑ ูุชุตู)
- ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุชุตููู
- ุตูุฑ ุฑูุฒูุฉ ูููุณุชุฎุฏููู

### CollaborationCursor
```tsx
<CollaborationCursor cursor={cursorData} editorRef={editorElement} />
```
ูุนุฑุถ:
- ูุคุดุฑุงุช ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู
- ุฃุณูุงุก ุงููุณุชุฎุฏููู
- ุฃููุงู ูููุฒุฉ ููู ูุณุชุฎุฏู

## ๐ ุงูุฃูุงู

### ุงูุฅุฌุฑุงุกุงุช ุงููุทุจูุฉ:
- โ ุชูููู CORS ููุงุณุจ
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- โ ุชูุธูู ุงูุบุฑู ุงููุงุฑุบุฉ
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ

### ุงูุชูุตูุงุช ููุฅูุชุงุฌ:
- ุฅุถุงูุฉ ูุตุงุฏูุฉ ุงููุณุชุฎุฏู
- ุงุณุชุฎุฏุงู HTTPS
- ุชุทุจูู ุญุฏูุฏ ุนูู ุญุฌู ุงูุบุฑูุฉ
- ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู
- ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ

## ๐ ุงูุฃุฏุงุก

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โ ุชูุธูู ุชููุงุฆู ููุบุฑู ุงููุงุฑุบุฉ (ูู 5 ุฏูุงุฆู)
- โ ุถุบุท ุงูุชุญุฏูุซุงุช (ุชุฑููุฒ Y.js ุงููุนุงู)
- โ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุงูุชููุงุฆู
- โ ูุฒุงููุฉ ุชูุงุถููุฉ (ุฅุฑุณุงู ุงูุชุบููุฑุงุช ููุท)

### ุงุนุชุจุงุฑุงุช ูุงุจููุฉ ุงูุชูุณุน:
- ุงุณุชุฎุฏุงู Redis Adapter ูู Socket.IO
- ุชุฎุฒูู ุงูุญุงูุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุช
- ุงุณุชุฎุฏุงู CDN ูููููุงุช ุงูุซุงุจุชุฉ
- ุชุทุจูู ุญุฏูุฏ ูุนุฏู ุงูุทูุจุงุช

## ๐ ุงููุซุงุฆู

ุฑุงุฌุน [docs/COLLABORATION.md](../docs/COLLABORATION.md) ููุญุตูู ุนูู:
- ุฏููู ุงูุงุณุชุฎุฏุงู ุงููุงูู
- ุฃูุซูุฉ ุงูููุฏ
- ูุฑุฌุน API
- ุงุณุชูุดุงู ุงูุฃุฎุทุงุก
- ุฃูุถู ุงูููุงุฑุณุงุช

## โ ูุนุงููุฑ ุงูุฅูุฌุงุฒ

- [x] ุฎุงุฏู WebSocket ูุนูู ุจุดูู ูุงูู
- [x] ูุธุงู CRDT ูุชูุงูู ุจุงุณุชุฎุฏุงู Yjs
- [x] ููููุงุช React ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู
- [x] 17 ุงุฎุชุจุงุฑ ุดุงูู (ุฌููุนูุง ูุงุฌุญุฉ)
- [x] ุงุฎุชุจุงุฑุงุช ุฎุตุงุฆุต CRDT
- [x] ุงุฎุชุจุงุฑุงุช ุชูุงูู WebSocket
- [x] ูุซุงู ุชุฌุฑูุจู ุชูุงุนูู
- [x] ูุซุงุฆู ุดุงููุฉ
- [x] ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ
- [x] ุชุญุณููุงุช ุงูุฃุฏุงุก

## ๐ ุงููุฑุงุฌุน

- [Yjs Documentation](https://docs.yjs.dev/)
- [Socket.IO Documentation](https://socket.io/docs/)
- [CRDT Explained](https://crdt.tech/)
- [Conflict-free Replicated Data Types](https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type)

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅูุฌุงุฒ **Epic 5: WebSocket and Live Collaboration** ุจูุฌุงุญ ูุงูู! ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ููุชุถูู:

1. โ ุฎุงุฏู WebSocket ููู ูููุซูู
2. โ ูุธุงู CRDT ูุชูุฏู ููุชุนุงูู ุงูุญู
3. โ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ุชุถูู ุงูุฌูุฏุฉ
4. โ ูุซุงู ุชุฌุฑูุจู ุนููู
5. โ ูุซุงุฆู ูุงููุฉ ูููุทูุฑูู

ุงููุธุงู ูุฏุนู ุงูุชุนุงูู ูู ุงูููุช ุงููุนูู ูุนุฏุฏ ุบูุฑ ูุญุฏูุฏ ูู ุงููุณุชุฎุฏูููุ ูุน ุถูุงู ุงูุชุฒุงูู ุงููุงูู ูุนุฏู ูุฌูุฏ ุชุนุงุฑุถุงุช ูู ุงูุชุนุฏููุงุช ุงููุชุฒุงููุฉ.
